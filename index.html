<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‡ ä½•æ•°æ®å±•ç¤ºå·¥å…· - åŒåœ°å›¾åˆ‡æ¢ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }
        
        #baidu-container, #amap-container {
            width: 100%;
            height: 100%;
            display: none;
        }
        
        #baidu-container.active, #amap-container.active {
            display: block;
        }
        
        .map-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: flex;
            overflow: hidden;
        }
        
        .map-switch-btn {
            padding: 10px 16px;
            border: none;
            background: white;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .map-switch-btn.active {
            background: #3388FF;
            color: white;
        }
        
        .map-switch-btn:first-child {
            border-radius: 8px 0 0 8px;
        }
        
        .map-switch-btn:last-child {
            border-radius: 0 8px 8px 0;
        }
        
        .control-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 420px;
            background: white;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            z-index: 10;
            max-height: 95vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .panel-header {
            background: linear-gradient(135deg, #3388FF, #4A90E2);
            color: white;
            padding: 18px 20px;
            border-radius: 12px 12px 0 0;
            margin: 0;
            position: sticky;
            top: 0;
            z-index: 11;
            flex-shrink: 0;
        }
        
        .panel-header h3 {
            margin: 0;
            font-size: 20px;
            text-align: center;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .panel-content {
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #eaeaea;
            margin-bottom: 0;
            background: white;
            z-index: 10;
            flex-shrink: 0;
            border-radius: 8px 8px 0 0;
            overflow: hidden;
        }
        
        .tab {
            flex: 1;
            padding: 14px 8px;
            text-align: center;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-size: 15px;
            font-weight: 500;
            color: #666;
        }
        
        .tab.active {
            border-bottom: 3px solid #3388FF;
            color: #3388FF;
            background-color: #f8fbff;
        }
        
        .current-tab-indicator {
            background: #e7f3ff;
            padding: 12px 16px;
            border-radius: 8px;
            margin: 0;
            font-size: 14px;
            border-left: 4px solid #3388FF;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .current-tab-indicator::before {
            content: "ğŸ“";
            font-size: 16px;
        }
        
        .action-buttons {
            background: white;
            padding: 0 0 12px 0;
            margin: 0;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .main-button-group {
            display: flex;
            gap: 10px;
            margin: 0;
        }
        
        .main-button-group button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .btn-primary {
            background: #3388FF;
            color: white;
        }
        
        .btn-primary:hover {
            background: #297acc;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(51, 136, 255, 0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(108, 117, 125, 0.3);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(255, 193, 7, 0.3);
        }
        
        .tab-content {
            display: none;
            flex: 1;
            flex-direction: column;
            gap: 12px;
        }
        
        .tab-content.active {
            display: flex;
        }
        
        .format-indicator {
            padding: 10px 14px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 13px;
            border-left: 4px solid #28a745;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .format-indicator::before {
            content: "ğŸ“‹";
        }
        
        .format-indicator.wkt {
            border-left-color: #3388FF;
        }
        
        .format-indicator.coords {
            border-left-color: #28a745;
        }
        
        .input-item {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 0;
        }
        
        .input-item textarea {
            width: 100%;
            flex: 1;
            min-height: 320px;
            margin: 0;
            padding: 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            resize: vertical;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            box-sizing: border-box;
            line-height: 1.6;
            transition: border 0.3s;
        }
        
        .input-item textarea:focus {
            border-color: #3388FF;
            outline: none;
            box-shadow: 0 0 0 2px rgba(51, 136, 255, 0.2);
        }
        
        .format-example {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
            font-style: italic;
            flex-shrink: 0;
            padding: 0 4px;
        }
        
        .legend {
            padding: 14px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 12px;
            border-top: 1px solid #eee;
            margin-top: 10px;
        }
        
        .legend-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #444;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .legend-title::before {
            content: "ğŸ¨";
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 6px 0;
        }
        
        .legend-color {
            width: 20px;
            height: 4px;
            margin-right: 8px;
            border-radius: 2px;
        }
        
        .legend-point {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .legend-line {
            background-color: #3388FF;
        }
        
        .legend-polygon {
            background-color: #FF6B6B;
        }
        
        .legend-point-color {
            background-color: #28a745;
        }
        
        .status-message {
            padding: 10px 14px;
            border-radius: 6px;
            font-size: 13px;
            margin-top: 8px;
            display: none;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        @media (max-width: 768px) {
            .control-panel {
                width: calc(100% - 40px);
                max-height: 85vh;
            }
            
            .input-item textarea {
                min-height: 250px;
            }
            
            .panel-content {
                gap: 12px;
            }
            
            .main-button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- åœ°å›¾å®¹å™¨ -->
    <div id="baidu-container"></div>
    <div id="amap-container" class="active"></div>
    
    <!-- åœ°å›¾åˆ‡æ¢å™¨ -->
    <div class="map-switcher">
        <button class="map-switch-btn" id="switch-amap">
            <span>ğŸ—ºï¸</span> é«˜å¾·åœ°å›¾
        </button>
        <button class="map-switch-btn" id="switch-baidu">
            <span>ğŸŒ</span> ç™¾åº¦åœ°å›¾
        </button>
    </div>
    
    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
        <div class="panel-header">
            <h3>å‡ ä½•æ•°æ®å±•ç¤ºå·¥å…·</h3>
        </div>
        
        <div class="panel-content">
            <!-- æ ‡ç­¾å¯¼èˆª - å¤šè¾¹å½¢æ•°æ®é»˜è®¤æ¿€æ´» -->
            <div class="tabs">
                <div class="tab" data-tab="points">ç‚¹æ•°æ®</div>
                <div class="tab" data-tab="lines">çº¿æ•°æ®</div>
                <div class="tab active" data-tab="polygons">å¤šè¾¹å½¢æ•°æ®</div>
            </div>
            
            <!-- å½“å‰é€‰ä¸­æŒ‡ç¤ºå™¨ -->
            <div class="current-tab-indicator" id="current-tab-indicator">
                å½“å‰é€‰ä¸­: <strong>å¤šè¾¹å½¢æ•°æ®</strong>
            </div>
            
            <!-- æ“ä½œæŒ‰é’® -->
            <div class="action-buttons">
                <div class="main-button-group">
                    <button class="btn-success" id="show-current-btn">
                        <span>ğŸ”</span> æ˜¾ç¤ºå½“å‰å›¾å½¢
                    </button>
                    <button class="btn-primary" id="show-all-btn">
                        <span>ğŸ—ºï¸</span> æ˜¾ç¤ºæ‰€æœ‰å›¾å½¢
                    </button>
                    <button class="btn-secondary" id="clear-all-btn">
                        <span>ğŸ—‘ï¸</span> æ¸…é™¤æ‰€æœ‰
                    </button>
                </div>
            </div>
            
            <!-- ç‚¹æ•°æ®æ ‡ç­¾é¡µ -->
            <div class="tab-content" id="points-tab">
                <div class="format-indicator" id="points-format-indicator">
                    æ£€æµ‹åˆ°æ ¼å¼: <strong>WKT</strong>
                </div>
                <div class="input-item">
                    <textarea id="points-input" placeholder="è¯·è¾“å…¥ç‚¹æ•°æ®ï¼Œæ”¯æŒä»¥ä¸‹æ ¼å¼ï¼š

åæ ‡ä¸²æ ¼å¼ç¤ºä¾‹:
116.123,39.456;116.124,39.457

WKTæ ¼å¼ç¤ºä¾‹:
POINT(116.123 39.456)
MULTIPOINT((116.123 39.456),(116.124 39.457))">116.404,39.915;116.405,39.916;116.406,39.917</textarea>
                </div>
                <div class="format-example">
                    æç¤º: ç‚¹æ•°æ®æ”¯æŒåæ ‡ä¸²(ç»åº¦,çº¬åº¦;ç»åº¦,çº¬åº¦)å’ŒWKT(POINT/MULTIPOINT)æ ¼å¼
                </div>
            </div>
            
            <!-- çº¿æ•°æ®æ ‡ç­¾é¡µ -->
            <div class="tab-content" id="lines-tab">
                <div class="format-indicator" id="lines-format-indicator">
                    æ£€æµ‹åˆ°æ ¼å¼: <strong>WKT</strong>
                </div>
                <div class="input-item">
                    <textarea id="lines-input" placeholder="è¯·è¾“å…¥çº¿æ•°æ®ï¼Œæ”¯æŒä»¥ä¸‹æ ¼å¼ï¼š

åæ ‡ä¸²æ ¼å¼ç¤ºä¾‹:
116.123,39.456;116.124,39.457|116.125,39.458;116.126,39.459

WKTæ ¼å¼ç¤ºä¾‹:
LINESTRING(116.123 39.456,116.124 39.457)
MULTILINESTRING((116.123 39.456,116.124 39.457),(116.125 39.458,116.126 39.459))">116.404,39.915;116.405,39.916;116.406,39.917|116.407,39.918;116.408,39.919</textarea>
                </div>
                <div class="format-example">
                    æç¤º: çº¿æ•°æ®æ”¯æŒåæ ‡ä¸²(ä½¿ç”¨|åˆ†éš”ä¸åŒçº¿æ®µ)å’ŒWKT(LINESTRING/MULTILINESTRING)æ ¼å¼
                </div>
            </div>
            
            <!-- å¤šè¾¹å½¢æ•°æ®æ ‡ç­¾é¡µ - é»˜è®¤æ¿€æ´» -->
            <div class="tab-content active" id="polygons-tab">
                <div class="format-indicator" id="polygon-format-indicator">
                    æ£€æµ‹åˆ°æ ¼å¼: <strong>WKT</strong>
                </div>
                <div class="input-item">
                    <textarea id="polygon-input" placeholder="è¯·è¾“å…¥å¤šè¾¹å½¢æ•°æ®ï¼Œæ”¯æŒä»¥ä¸‹æ ¼å¼ï¼š

åæ ‡ä¸²æ ¼å¼ç¤ºä¾‹:
116.123,39.456;116.124,39.457;116.125,39.458;116.123,39.456

WKTæ ¼å¼ç¤ºä¾‹:
POLYGON((116.123 39.456,116.124 39.457,116.125 39.458,116.123 39.456))
MULTIPOLYGON(((116.123 39.456,116.124 39.457,116.125 39.458,116.123 39.456)))">116.419801,39.909222;116.419734,39.908797;116.419999,39.908748;116.42003,39.908894;116.420425,39.90888;116.420421,39.908869;116.420416,39.90916;116.419801,39.909222</textarea>
                </div>
                <div class="format-example">
                    æç¤º: å¤šè¾¹å½¢æ•°æ®æ”¯æŒåæ ‡ä¸²(é¦–å°¾åæ ‡éœ€ç›¸åŒä»¥é—­åˆ)å’ŒWKT(POLYGON/MULTIPOLYGON)æ ¼å¼
                </div>
            </div>
            
            <!-- çŠ¶æ€æ¶ˆæ¯ -->
            <div class="status-message" id="status-message"></div>
            
            <!-- å›¾ä¾‹ -->
            <div class="legend">
                <div class="legend-title">å›¾ä¾‹è¯´æ˜</div>
                <div class="legend-item">
                    <div class="legend-point legend-point-color"></div>
                    <span>ç‚¹æ•°æ®</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-line"></div>
                    <span>çº¿æ•°æ®</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-polygon"></div>
                    <span>å¤šè¾¹å½¢æ•°æ®</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ç™¾åº¦åœ°å›¾ç›¸å…³è„šæœ¬ -->
    <script src="//api.map.baidu.com/api?v=1.0&type=webgl&ak=vzz9Wpy0k1X3D7zFW04sf7xBLxhR6iRx"></script>
    <script src="//mapv.baidu.com/build/mapv.min.js"></script>
    <script src="https://code.bdstatic.com/npm/mapvgl@1.0.0-beta.189/dist/mapvgl.min.js"></script>
    
    <!-- é«˜å¾·åœ°å›¾ç›¸å…³è„šæœ¬ -->
    <script src="https://cache.amap.com/lbs/static/es5.min.js"></script>
    <script src="https://webapi.amap.com/maps?v=2.0&key=1cf9fc45df860df45e87af1230f5da74"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let currentMap = 'amap'; // é»˜è®¤ä½¿ç”¨é«˜å¾·åœ°å›¾
            let amap, baiduMap;
            let amapLayers = { points: [], lines: [], polygons: [] };
            let baiduLayers = { points: [], lines: [], polygons: [] };
            
            // åˆå§‹åŒ–é«˜å¾·åœ°å›¾
            function initAMap() {
                amap = new AMap.Map('amap-container', {
                    zoom: 17,
                    center: [116.420, 39.909],
                    viewMode: '3D'
                });
            }
            
            // åˆå§‹åŒ–ç™¾åº¦åœ°å›¾
            function initBaiduMap() {
                baiduMap = new BMapGL.Map("baidu-container");
                baiduMap.centerAndZoom(new BMapGL.Point(116.420, 39.909), 17);
                baiduMap.enableScrollWheelZoom(true);
                baiduMap.setTilt(0);
                baiduMap.setHeading(0);
            }
            
            // åœ°å›¾åˆ‡æ¢åŠŸèƒ½
            function switchMap(mapType) {
                currentMap = mapType;
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                document.getElementById('switch-amap').classList.toggle('active', mapType === 'amap');
                document.getElementById('switch-baidu').classList.toggle('active', mapType === 'baidu');
                
                // åˆ‡æ¢åœ°å›¾æ˜¾ç¤º
                document.getElementById('amap-container').classList.toggle('active', mapType === 'amap');
                document.getElementById('baidu-container').classList.toggle('active', mapType === 'baidu');
                
                // é‡æ–°æ˜¾ç¤ºå½“å‰æ•°æ®
                setTimeout(() => {
                    showAll();
                }, 100);
            }
            
            // æ ‡ç­¾åˆ‡æ¢åŠŸèƒ½
            function initTabs() {
                const tabs = document.querySelectorAll('.tab');
                const tabContents = document.querySelectorAll('.tab-content');
                const indicator = document.getElementById('current-tab-indicator');
                
                tabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const tabName = this.getAttribute('data-tab');
                        
                        // æ›´æ–°æ ‡ç­¾çŠ¶æ€
                        tabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        
                        // æ›´æ–°å†…å®¹æ˜¾ç¤º
                        tabContents.forEach(content => {
                            content.classList.remove('active');
                            if (content.id === `${tabName}-tab`) {
                                content.classList.add('active');
                            }
                        });
                        
                        // æ›´æ–°æŒ‡ç¤ºå™¨
                        indicator.innerHTML = `å½“å‰é€‰ä¸­: <strong>${this.textContent}</strong>`;
                    });
                });
            }
            
            // è‡ªåŠ¨æ£€æµ‹æ ¼å¼çš„å‡½æ•°
            function detectFormat(input, type) {
                if (!input || input.trim() === '') return 'unknown';
                
                var text = input.trim().toUpperCase();
                
                // WKTæ ¼å¼æ£€æµ‹
                if (type === 'points') {
                    if (text.startsWith('MULTIPOINT') || text.startsWith('POINT')) return 'wkt';
                } else if (type === 'lines') {
                    if (text.startsWith('MULTILINESTRING') || text.startsWith('LINESTRING')) return 'wkt';
                } else if (type === 'polygons') {
                    if (text.startsWith('MULTIPOLYGON') || text.startsWith('POLYGON')) return 'wkt';
                }
                
                // åæ ‡ä¸²æ ¼å¼æ£€æµ‹
                if (input.includes(';')) {
                    var parts = input.split(';');
                    var validCoords = parts.some(part => {
                        var coords = part.split(',');
                        if (coords.length === 2) {
                            var lng = parseFloat(coords[0]), lat = parseFloat(coords[1]);
                            return !isNaN(lng) && !isNaN(lat);
                        }
                        return false;
                    });
                    if (validCoords) return 'coords';
                }
                
                return 'unknown';
            }
            
            // è§£æåæ ‡ä¸²æ ¼å¼çš„ç‚¹æ•°æ®
            function parsePointsFromCoords(input) {
                const points = [];
                const pointStrings = input.split(';');
                
                pointStrings.forEach(pointStr => {
                    const parts = pointStr.split(',');
                    if (parts.length >= 2) {
                        const lng = parseFloat(parts[0]);
                        const lat = parseFloat(parts[1]);
                        if (!isNaN(lng) && !isNaN(lat)) {
                            points.push([lng, lat]);
                        }
                    }
                });
                
                return points;
            }
            
            // è§£æåæ ‡ä¸²æ ¼å¼çš„çº¿æ•°æ®
            function parseLinesFromCoords(input) {
                const lines = [];
                const lineStrings = input.split('|');
                
                lineStrings.forEach(lineStr => {
                    const points = [];
                    const pointStrings = lineStr.split(';');
                    
                    pointStrings.forEach(pointStr => {
                        const parts = pointStr.split(',');
                        if (parts.length >= 2) {
                            const lng = parseFloat(parts[0]);
                            const lat = parseFloat(parts[1]);
                            if (!isNaN(lng) && !isNaN(lat)) {
                                points.push([lng, lat]);
                            }
                        }
                    });
                    
                    if (points.length > 0) {
                        lines.push(points);
                    }
                });
                
                return lines;
            }
            
            // è§£æåæ ‡ä¸²æ ¼å¼çš„å¤šè¾¹å½¢æ•°æ®
            function parsePolygonsFromCoords(input) {
                const polygons = [];
                const polygonStrings = input.split('|');
                
                polygonStrings.forEach(polygonStr => {
                    const points = [];
                    const pointStrings = polygonStr.split(';');
                    
                    pointStrings.forEach(pointStr => {
                        const parts = pointStr.split(',');
                        if (parts.length >= 2) {
                            const lng = parseFloat(parts[0]);
                            const lat = parseFloat(parts[1]);
                            if (!isNaN(lng) && !isNaN(lat)) {
                                points.push([lng, lat]);
                            }
                        }
                    });
                    
                    // ç¡®ä¿å¤šè¾¹å½¢é—­åˆ
                    if (points.length >= 3) {
                        // æ£€æŸ¥é¦–å°¾ç‚¹æ˜¯å¦ç›¸åŒï¼Œå¦‚æœä¸åŒåˆ™æ·»åŠ é¦–ç‚¹ä½¿å…¶é—­åˆ
                        const firstPoint = points[0];
                        const lastPoint = points[points.length - 1];
                        if (firstPoint[0] !== lastPoint[0] || firstPoint[1] !== lastPoint[1]) {
                            points.push([firstPoint[0], firstPoint[1]]);
                        }
                        polygons.push([points]);
                    }
                });
                
                return polygons;
            }
            
            // é«˜å¾·åœ°å›¾æ˜¾ç¤ºå‡½æ•°
            function showPointsAMap(points) {
                // æ¸…é™¤ç°æœ‰ç‚¹
                amapLayers.points.forEach(point => amap.remove(point));
                amapLayers.points = [];
                
                if (points.length === 0) return;
                
                points.forEach(point => {
                    const marker = new AMap.Marker({
                        position: point,
                        icon: new AMap.Icon({
                            size: new AMap.Size(12, 12),
                            image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIHZpZXdCb3g9IjAgMCAxMiAxMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSI2IiBjeT0iNiIgcj0iNiIgZmlsbD0iIzI4YTc0NSIvPjwvc3ZnPg==',
                            anchor: 'center'
                        })
                    });
                    amap.add(marker);
                    amapLayers.points.push(marker);
                });
                
                // è°ƒæ•´è§†å›¾
                if (amapLayers.points.length > 0) {
                    amap.setFitView(amapLayers.points);
                }
            }
            
            function showLinesAMap(lines) {
                // æ¸…é™¤ç°æœ‰çº¿
                amapLayers.lines.forEach(line => amap.remove(line));
                amapLayers.lines = [];
                
                if (lines.length === 0) return;
                
                lines.forEach(linePoints => {
                    const polyline = new AMap.Polyline({
                        path: linePoints,
                        strokeColor: '#3388FF',
                        strokeWeight: 4,
                        strokeOpacity: 0.8
                    });
                    amap.add(polyline);
                    amapLayers.lines.push(polyline);
                });
                
                // è°ƒæ•´è§†å›¾
                if (amapLayers.lines.length > 0) {
                    amap.setFitView(amapLayers.lines);
                }
            }
            
            function showPolygonsAMap(polygons) {
                // æ¸…é™¤ç°æœ‰å¤šè¾¹å½¢
                amapLayers.polygons.forEach(polygon => amap.remove(polygon));
                amapLayers.polygons = [];
                
                if (polygons.length === 0) return;
                
                console.log('æ˜¾ç¤ºå¤šè¾¹å½¢æ•°æ®:', polygons);
                
                polygons.forEach(polygonPaths => {
                    const polygon = new AMap.Polygon({
                        path: polygonPaths[0],
                        fillColor: '#FF6B6B',
                        fillOpacity: 0.4,
                        strokeColor: '#FF6B6B',
                        strokeWeight: 2,
                        strokeOpacity: 0.8
                    });
                    amap.add(polygon);
                    amapLayers.polygons.push(polygon);
                });
                
                // è°ƒæ•´è§†å›¾
                if (amapLayers.polygons.length > 0) {
                    amap.setFitView(amapLayers.polygons);
                }
            }
            
            // ç™¾åº¦åœ°å›¾æ˜¾ç¤ºå‡½æ•°
            function showPointsBaidu(points) {
                // æ¸…é™¤ç°æœ‰ç‚¹
                baiduLayers.points.forEach(point => baiduMap.removeOverlay(point));
                baiduLayers.points = [];
                
                if (points.length === 0) return;
                
                points.forEach(point => {
                    const marker = new BMapGL.Marker(new BMapGL.Point(point[0], point[1]));
                    baiduMap.addOverlay(marker);
                    baiduLayers.points.push(marker);
                });
                
                // è°ƒæ•´è§†å›¾
                fitBoundsToDataBaidu(points, 'point');
            }
            
            function showLinesBaidu(lines) {
                // æ¸…é™¤ç°æœ‰çº¿
                baiduLayers.lines.forEach(line => baiduMap.removeOverlay(line));
                baiduLayers.lines = [];
                
                if (lines.length === 0) return;
                
                const allPoints = [];
                lines.forEach(linePoints => {
                    const bPoints = linePoints.map(point => new BMapGL.Point(point[0], point[1]));
                    const polyline = new BMapGL.Polyline(bPoints, {
                        strokeColor: '#3388FF',
                        strokeWeight: 4,
                        strokeOpacity: 0.8
                    });
                    baiduMap.addOverlay(polyline);
                    baiduLayers.lines.push(polyline);
                    allPoints.push(...linePoints);
                });
                
                // è°ƒæ•´è§†å›¾
                if (allPoints.length > 0) {
                    fitBoundsToDataBaidu(allPoints, 'point');
                }
            }
            
            function showPolygonsBaidu(polygons) {
                // æ¸…é™¤ç°æœ‰å¤šè¾¹å½¢
                baiduLayers.polygons.forEach(polygon => baiduMap.removeOverlay(polygon));
                baiduLayers.polygons = [];
                
                if (polygons.length === 0) return;
                
                console.log('æ˜¾ç¤ºå¤šè¾¹å½¢æ•°æ®:', polygons);
                
                const allPoints = [];
                polygons.forEach(polygonPaths => {
                    const bPoints = polygonPaths[0].map(point => new BMapGL.Point(point[0], point[1]));
                    const polygon = new BMapGL.Polygon(bPoints, {
                        fillColor: '#FF6B6B',
                        fillOpacity: 0.4,
                        strokeColor: '#FF6B6B',
                        strokeWeight: 2,
                        strokeOpacity: 0.8
                    });
                    baiduMap.addOverlay(polygon);
                    baiduLayers.polygons.push(polygon);
                    allPoints.push(...polygonPaths[0]);
                });
                
                // è°ƒæ•´è§†å›¾
                if (allPoints.length > 0) {
                    fitBoundsToDataBaidu(allPoints, 'point');
                }
            }
            
            // ç™¾åº¦åœ°å›¾è¾¹ç•Œé€‚é…
            function fitBoundsToDataBaidu(points, type) {
                if (!points || points.length === 0) return;
                
                const bounds = new BMapGL.Bounds();
                points.forEach(point => {
                    if (type === 'point') {
                        bounds.extend(new BMapGL.Point(point[0], point[1]));
                    }
                });
                
                baiduMap.setViewport([bounds.getSouthWest(), bounds.getNorthEast()]);
            }
            
            // æ˜¾ç¤ºå½“å‰æ ‡ç­¾é¡µçš„æ•°æ®
            function showCurrent() {
                const activeTab = document.querySelector('.tab.active').getAttribute('data-tab');
                const inputElement = document.getElementById(`${activeTab}-input`);
                const input = inputElement.value.trim();
                
                if (!input) {
                    showStatus(`${getTabName(activeTab)}è¾“å…¥ä¸ºç©º`, false);
                    return;
                }
                
                const format = detectFormat(input, activeTab);
                
                try {
                    if (format === 'coords') {
                        if (activeTab === 'points') {
                            const points = parsePointsFromCoords(input);
                            if (currentMap === 'amap') {
                                showPointsAMap(points);
                            } else {
                                showPointsBaidu(points);
                            }
                            showStatus(`æˆåŠŸæ˜¾ç¤º ${points.length} ä¸ªç‚¹`, true);
                        } else if (activeTab === 'lines') {
                            const lines = parseLinesFromCoords(input);
                            if (currentMap === 'amap') {
                                showLinesAMap(lines);
                            } else {
                                showLinesBaidu(lines);
                            }
                            showStatus(`æˆåŠŸæ˜¾ç¤º ${lines.length} æ¡çº¿`, true);
                        } else if (activeTab === 'polygons') {
                            const polygons = parsePolygonsFromCoords(input);
                            console.log('è§£æå‡ºçš„å¤šè¾¹å½¢:', polygons);
                            if (currentMap === 'amap') {
                                showPolygonsAMap(polygons);
                            } else {
                                showPolygonsBaidu(polygons);
                            }
                            showStatus(`æˆåŠŸæ˜¾ç¤º ${polygons.length} ä¸ªå¤šè¾¹å½¢`, true);
                        }
                    } else {
                        showStatus('æš‚ä¸æ”¯æŒWKTæ ¼å¼ï¼Œè¯·ä½¿ç”¨åæ ‡ä¸²æ ¼å¼', false);
                    }
                } catch (error) {
                    showStatus('è§£æé”™è¯¯: ' + error.message, false);
                    console.error('è§£æé”™è¯¯:', error);
                }
            }
            
            // æ˜¾ç¤ºæ‰€æœ‰æ•°æ®
            function showAll() {
                // å…ˆæ¸…é™¤æ‰€æœ‰
                clearAll();
                
                // æ˜¾ç¤ºæ‰€æœ‰æ ‡ç­¾é¡µçš„æ•°æ®
                ['points', 'lines', 'polygons'].forEach(tab => {
                    const inputElement = document.getElementById(`${tab}-input`);
                    const input = inputElement.value.trim();
                    
                    if (!input) return;
                    
                    const format = detectFormat(input, tab);
                    
                    try {
                        if (format === 'coords') {
                            if (tab === 'points') {
                                const points = parsePointsFromCoords(input);
                                if (currentMap === 'amap') {
                                    showPointsAMap(points);
                                } else {
                                    showPointsBaidu(points);
                                }
                            } else if (tab === 'lines') {
                                const lines = parseLinesFromCoords(input);
                                if (currentMap === 'amap') {
                                    showLinesAMap(lines);
                                } else {
                                    showLinesBaidu(lines);
                                }
                            } else if (tab === 'polygons') {
                                const polygons = parsePolygonsFromCoords(input);
                                if (currentMap === 'amap') {
                                    showPolygonsAMap(polygons);
                                } else {
                                    showPolygonsBaidu(polygons);
                                }
                            }
                        }
                    } catch (error) {
                        console.error(`è§£æ${tab}æ•°æ®é”™è¯¯:`, error);
                    }
                });
                
                showStatus('å·²æ˜¾ç¤ºæ‰€æœ‰å›¾å½¢æ•°æ®', true);
            }
            
            function clearAll() {
                if (currentMap === 'amap') {
                    amapLayers.points.forEach(point => amap.remove(point));
                    amapLayers.lines.forEach(line => amap.remove(line));
                    amapLayers.polygons.forEach(polygon => amap.remove(polygon));
                    amapLayers = { points: [], lines: [], polygons: [] };
                } else {
                    baiduLayers.points.forEach(point => baiduMap.removeOverlay(point));
                    baiduLayers.lines.forEach(line => baiduMap.removeOverlay(line));
                    baiduLayers.polygons.forEach(polygon => baiduMap.removeOverlay(polygon));
                    baiduLayers = { points: [], lines: [], polygons: [] };
                }
                showStatus('å·²æ¸…é™¤æ‰€æœ‰å›¾å½¢', true);
            }
            
            function getTabName(tab) {
                const names = {
                    'points': 'ç‚¹æ•°æ®',
                    'lines': 'çº¿æ•°æ®', 
                    'polygons': 'å¤šè¾¹å½¢æ•°æ®'
                };
                return names[tab] || 'æ•°æ®';
            }
            
            function showStatus(message, isSuccess) {
                var statusElement = document.getElementById('status-message');
                statusElement.textContent = message;
                statusElement.className = 'status-message ' + (isSuccess ? 'status-success' : 'status-error');
                statusElement.style.display = 'block';
                
                setTimeout(function() {
                    statusElement.style.display = 'none';
                }, 5000);
            }
            
            // åˆå§‹åŒ–
            initAMap();
            initBaiduMap();
            initTabs();
            
            // äº‹ä»¶ç›‘å¬
            document.getElementById('switch-amap').addEventListener('click', () => switchMap('amap'));
            document.getElementById('switch-baidu').addEventListener('click', () => switchMap('baidu'));
            document.getElementById('show-current-btn').addEventListener('click', showCurrent);
            document.getElementById('show-all-btn').addEventListener('click', showAll);
            document.getElementById('clear-all-btn').addEventListener('click', clearAll);
            
            // è®¾ç½®é»˜è®¤åœ°å›¾
            switchMap('amap');
        });
    </script>
</body>
</html>
